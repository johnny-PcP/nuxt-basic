# AI 助手專案指引

這個檔案提供給 AI 助手（如 GitHub Copilot）關於此專案的重要資訊。

## 專案特殊設定

### 🚫 關鍵限制：NO AUTO IMPORT

此專案**完全禁用**了 Nuxt 3 的自動導入功能：

- `imports.autoImport: false` 在 nuxt.config.ts
- `components: false` 在 nuxt.config.ts
- 所有 Vue、Nuxt、第三方庫的函數都必須手動導入

### ✅ 必須遵循的導入模式

#### Vue 3 Composition API

```typescript
import { ref, reactive, computed, watch, onMounted, nextTick } from 'vue';
```

#### Nuxt 3 核心功能

```typescript
import { useRuntimeConfig, navigateTo, createError } from '#app';
import { $fetch } from 'ofetch';
```

#### 路由和狀態管理

```typescript
import { useRoute, useRouter } from 'vue-router';
```

#### 專案內部模組

```typescript
import { userApi } from '~/service/api/user';
import type { User, CreateUserInput } from '~/service/schema/user';
import { useProjectConfig } from '~/composables/useProjectConfig';
```

## 強制架構規範

### 1. Service 層必須使用 Zod 驗證

```typescript
// ✅ 正確：所有 API 都必須使用 Zod 驗證
async getUsers(): Promise<UserList> {
  const response = await $fetch('/users.json')
  return UserListSchema.parse(response)  // 必須有這行
}

// ❌ 錯誤：直接回傳未驗證的資料
async getUsers() {
  return await $fetch('/users.json')  // 缺少 Zod 驗證
}
```

### 2. 配置管理規範

```typescript
// ✅ 正確：使用配置管理  const projectConfig = useProjectConfig();
const response = await $fetch('/users', { baseURL: projectConfig.baseURL });

// ❌ 錯誤：硬編碼 URL
const response = await $fetch('http://localhost:3000/api/users');
```

### 3. 型別安全要求

```typescript
// ✅ 正確：使用 Zod 推導的型別
import type { User } from '~/service/schema/user';
const users = ref<User[]>([]);

// ❌ 錯誤：使用 any 或手動定義型別
const users = ref<any>([]);
```

## 常見錯誤模式 - 避免這些！

### ❌ 自動導入相關錯誤

```typescript
// 這些會導致 "xxx is not defined" 錯誤
const config = useRuntimeConfig(); // useRuntimeConfig is not defined
const route = useRoute(); // useRoute is not defined
const data = ref([]); // ref is not defined
```

### ❌ 缺少 Zod 驗證

```typescript
// 直接使用 API 資料而不驗證
const users = await $fetch('/api/users');
// 應該要: UserListSchema.parse(await $fetch('/api/users'))
```

### ❌ 硬編碼配置

```typescript
// 不要在程式碼中硬編碼 URL 或設定
const baseURL = 'http://localhost:3000';
```

## 正確的開發模式

### Vue 元件範本

```vue
<script setup lang="ts">
// 1. 手動導入 Vue 功能
import { ref, onMounted, computed } from 'vue';

// 2. 手動導入 Nuxt 功能
import { useRuntimeConfig } from '#app';

// 3. 導入專案模組
import { userApi } from '~/service/api/user';
import type { User } from '~/service/schema/user';

// 4. 使用配置管理
const projectConfig = computed(() => userApi.getConfig());

// 5. 響應式資料
const users = ref<User[]>([]);

// 6. 生命週期
onMounted(async () => {
  try {
    users.value = await userApi.getUsers(); // 已經包含 Zod 驗證
  } catch (error) {
    console.error('載入失敗:', error);
  }
});
</script>
```

### API 服務範本

```typescript
import { $fetch } from 'ofetch';
import { useProjectConfig } from '~/composables/useProjectConfig';
import { UserSchema, UserListSchema } from '../schema/user';
import type { User, UserList } from '../schema/user';

export class UserApi {
  private getProjectConfig() {
    return useProjectConfig();
  }

  async getUsers(): Promise<UserList> {
    const config = this.getProjectConfig();
    const response = await $fetch('/users.json', {
      baseURL: config.baseURL,
    });
    return UserListSchema.parse(response); // 必須驗證
  }
}
```

## 環境配置

- 使用 `.env` 文件管理配置
- 支援 development/docker/production 環境
- 所有配置都通過 useProjectConfig() 存取

## 測試和除錯

- 訪問 `/myTest` 頁面進行功能測試
- 檢查瀏覽器控制台確認配置正確
- 使用 Zod 驗證測試功能確認 Schema 正確性

記住：這個專案的核心是展示在沒有自動導入的環境下，如何建立穩健、類型安全的 Service 層架構！
